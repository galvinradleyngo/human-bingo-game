<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Bingo Selfie Game</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCKVkzw8bHYiaqwS6J0xrTplhnXYdEQwiQ",
            authDomain: "human-bingo-game.firebaseapp.com",
            projectId: "human-bingo-game",
            storageBucket: "human-bingo-game.firebasestorage.app",
            messagingSenderId: "133740150923",
            appId: "1:133740150923:web:0266b47cb2cc4e0d1e548e"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const { useState, useRef, useEffect } = React;

        function HumanBingoGame() {
            const defaultCategories = [
                "Nervous about the future",
                "Nature Lover", 
                "Thinks their future job doesn't exist yet",
                "Secretly excited to grow older",
                "Would choose more free time over more money",
                "Believes our generation will do better",
                "Has a pet",
                "Binge watches shows",
                "Likes to read"
            ];

            const [categories, setCategories] = useState(defaultCategories);
            const [completedBoxes, setCompletedBoxes] = useState(new Set());
            const [photos, setPhotos] = useState({});
            const [names, setNames] = useState({});
            const [cameraIndex, setCameraIndex] = useState(null);
            const [previewIndex, setPreviewIndex] = useState(null);
            const [showNameInput, setShowNameInput] = useState(false);
            const [nameInput, setNameInput] = useState('');
            const [pendingPhotoIndex, setPendingPhotoIndex] = useState(null);

            // Customization states
            const [showCustomizer, setShowCustomizer] = useState(false);
            const [customCategories, setCustomCategories] = useState(['']);
            const [gameTitle, setGameTitle] = useState('Human Bingo Selfie');
            const [gameDescription, setGameDescription] = useState('Take selfies with people to complete your bingo!');
            const [creatorPassword, setCreatorPassword] = useState('');
            const [showPassword, setShowPassword] = useState(false);
            const [shareLink, setShareLink] = useState('');
            const [isCreatingLink, setIsCreatingLink] = useState(false);
            const [gameId, setGameId] = useState(null);
            const [isCustomGame, setIsCustomGame] = useState(false);
            const [isEditMode, setIsEditMode] = useState(false);
            const [showPasswordPrompt, setShowPasswordPrompt] = useState(false);
            const [passwordInput, setPasswordInput] = useState('');
            const [passwordError, setPasswordError] = useState('');

            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const fileInputRef = useRef(null);
            const [stream, setStream] = useState(null);
            const [useFileInput, setUseFileInput] = useState(false);

            const completedCount = completedBoxes.size;

            // Load game on component mount
            useEffect(() => {
                const loadGameFromURL = async () => {
                    try {
                        const urlParams = new URLSearchParams(window.location.search);
                        const gameIdParam = urlParams.get('game');
                        
                        if (gameIdParam) {
                            console.log('Loading game:', gameIdParam);
                            const gameDoc = await db.collection('games').doc(gameIdParam).get();
                            if (gameDoc.exists) {
                                const gameData = gameDoc.data();
                                setGameId(gameIdParam);
                                setIsCustomGame(true);
                                setGameTitle(gameData.title || 'Custom Human Bingo');
                                setGameDescription(gameData.description || 'Custom selfie bingo game!');
                                setCategories(gameData.categories || defaultCategories);
                                console.log('Game loaded successfully');
                            } else {
                                console.log('Game not found');
                            }
                        }
                    } catch (error) {
                        console.log('Could not load custom game:', error);
                    }
                };

                loadGameFromURL();
            }, []);

            const startCamera = async (index) => {
                setCameraIndex(index);
                try {
                    const mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
                    setStream(mediaStream);
                    if (videoRef.current) videoRef.current.srcObject = mediaStream;
                    setUseFileInput(false);
                } catch (error) {
                    console.log('Camera failed, using file input');
                    setUseFileInput(true);
                }
            };

            const stopCamera = () => {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    setStream(null);
                }
                setCameraIndex(null);
                setUseFileInput(false);
            };

            const capturePhoto = () => {
                if (videoRef.current && canvasRef.current) {
                    const canvas = canvasRef.current;
                    const video = videoRef.current;
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(video, 0, 0);
                    
                    const photoDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    setPhotos(prev => ({ ...prev, [cameraIndex]: photoDataUrl }));
                    setPendingPhotoIndex(cameraIndex);
                    setShowNameInput(true);
                    stopCamera();
                }
            };

            const handleFileInput = (event) => {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setPhotos(prev => ({ ...prev, [cameraIndex]: e.target.result }));
                        setPendingPhotoIndex(cameraIndex);
                        setShowNameInput(true);
                        setCameraIndex(null);
                        setUseFileInput(false);
                    };
                    reader.readAsDataURL(file);
                }
                event.target.value = '';
            };

            const saveName = () => {
                if (pendingPhotoIndex !== null) {
                    setNames(prev => ({ ...prev, [pendingPhotoIndex]: nameInput.trim() }));
                    setCompletedBoxes(prev => new Set([...prev, pendingPhotoIndex]));
                    setNameInput('');
                    setShowNameInput(false);
                    setPendingPhotoIndex(null);
                }
            };

            const skipName = () => {
                if (pendingPhotoIndex !== null) {
                    setCompletedBoxes(prev => new Set([...prev, pendingPhotoIndex]));
                    setNameInput('');
                    setShowNameInput(false);
                    setPendingPhotoIndex(null);
                }
            };

            const resetGame = () => {
                setCompletedBoxes(new Set());
                setPhotos({});
                setNames({});
                setPreviewIndex(null);
                setShowNameInput(false);
                setNameInput('');
                setPendingPhotoIndex(null);
                stopCamera();
            };

            // Edit mode functions
            const promptForPassword = () => {
                if (!isCustomGame || !gameId) {
                    alert('This is not a custom game that can be edited.');
                    return;
                }
                setPasswordInput('');
                setPasswordError('');
                setShowPasswordPrompt(true);
            };

            const verifyPassword = async () => {
                if (!passwordInput.trim()) {
                    setPasswordError('Please enter a password.');
                    return;
                }

                try {
                    const gameDoc = await db.collection('games').doc(gameId).get();
                    if (gameDoc.exists) {
                        const gameData = gameDoc.data();
                        if (gameData.password === passwordInput.trim()) {
                            setIsEditMode(true);
                            setShowPasswordPrompt(false);
                            setCreatorPassword(passwordInput.trim());
                            openCustomizer();
                        } else {
                            setPasswordError('Incorrect password. Please try again.');
                        }
                    } else {
                        setPasswordError('Game not found.');
                    }
                } catch (error) {
                    console.error('Error verifying password:', error);
                    setPasswordError('Error verifying password. Please try again.');
                }
            };

            const updateExistingGame = async () => {
                if (!gameId || !isEditMode) {
                    createShareLink();
                    return;
                }

                const validCategories = customCategories.filter(cat => cat.trim() !== '');
                if (validCategories.length < 4) {
                    alert('Please add at least 4 categories for your game.');
                    return;
                }

                setIsCreatingLink(true);
                try {
                    const gameData = {
                        title: gameTitle,
                        description: gameDescription,
                        categories: validCategories,
                        password: creatorPassword,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await db.collection('games').doc(gameId).update(gameData);
                    
                    const currentShareLink = `${window.location.origin}${window.location.pathname}?game=${gameId}`;
                    setShareLink(currentShareLink);
                    console.log('Game updated successfully');
                } catch (error) {
                    console.error('Error updating game:', error);
                    alert('Failed to update game: ' + error.message);
                } finally {
                    setIsCreatingLink(false);
                }
            };

            // Customization functions
            const openCustomizer = () => {
                setCustomCategories([...categories]);
                setShowCustomizer(true);
            };

            const addCustomCategory = () => {
                setCustomCategories([...customCategories, '']);
            };

            const removeCustomCategory = (index) => {
                if (customCategories.length > 1) {
                    setCustomCategories(customCategories.filter((_, i) => i !== index));
                }
            };

            const updateCustomCategory = (index, value) => {
                const newCategories = [...customCategories];
                newCategories[index] = value;
                setCustomCategories(newCategories);
            };

            const createShareLink = async () => {
                if (!creatorPassword.trim()) {
                    alert('Please enter a password to secure your custom game.');
                    return;
                }

                const validCategories = customCategories.filter(cat => cat.trim() !== '');
                if (validCategories.length < 4) {
                    alert('Please add at least 4 categories for your game.');
                    return;
                }

                setIsCreatingLink(true);
                console.log('Creating share link...');
                
                try {
                    const gameData = {
                        title: gameTitle,
                        description: gameDescription,
                        categories: validCategories,
                        password: creatorPassword,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
                    };

                    console.log('Saving game data:', gameData);
                    const docRef = await db.collection('games').add(gameData);
                    console.log('Game saved with ID:', docRef.id);
                    
                    const newShareLink = `${window.location.origin}${window.location.pathname}?game=${docRef.id}`;
                    setShareLink(newShareLink);
                    setGameId(docRef.id);
                    console.log('Share link created:', newShareLink);
                } catch (error) {
                    console.error('Error creating share link:', error);
                    alert('Failed to create share link: ' + error.message);
                } finally {
                    setIsCreatingLink(false);
                }
            };

            const copyShareLink = () => {
                navigator.clipboard.writeText(shareLink);
                alert('Share link copied to clipboard!');
            };

            const applyCustomization = () => {
                const validCategories = customCategories.filter(cat => cat.trim() !== '');
                if (validCategories.length < 4) {
                    alert('Please add at least 4 categories for your game.');
                    return;
                }
                setCategories(validCategories);
                setCompletedBoxes(new Set());
                setPhotos({});
                setNames({});
                setShowCustomizer(false);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 p-4 pb-8">
                    <div className="max-w-md mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
                        
                        {/* Header */}
                        <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
                            <h1 className="text-2xl font-bold text-center mb-2">📸 {gameTitle}</h1>
                            <p className="text-center text-indigo-100 text-sm">{gameDescription}</p>
                            <div className="mt-4 flex justify-between items-center">
                                <span className="text-sm bg-white/20 px-3 py-1 rounded-full">
                                    {completedCount}/{categories.length} completed
                                </span>
                                <div className="flex gap-2">
                                    <button
                                        onClick={openCustomizer}
                                        className="p-2 bg-blue-500/20 border border-blue-300/30 rounded-full hover:bg-blue-500/30 transition-colors"
                                    >
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                            <circle cx="12" cy="12" r="3"/>
                                            <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"/>
                                        </svg>
                                    </button>
                                    {isCustomGame && (
                                        <button
                                            onClick={promptForPassword}
                                            title="Edit this custom game"
                                            className="p-2 bg-green-500/20 border border-green-300/30 rounded-full hover:bg-green-500/30 transition-colors"
                                        >
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                            </svg>
                                        </button>
                                    )}
                                    <button
                                        onClick={resetGame}
                                        className="p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors"
                                    >
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                                            <path d="M3 3v5h5"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Password Prompt Modal */}
                        {showPasswordPrompt && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                                <div className="bg-white rounded-3xl p-6 max-w-sm w-full">
                                    <h2 className="text-xl font-bold text-center mb-4 text-gray-800">🔒 Enter Creator Password</h2>
                                    <p className="text-center text-sm text-gray-600 mb-4">Enter the password you used when creating this game to edit it.</p>
                                    <input
                                        type="password"
                                        value={passwordInput}
                                        onChange={(e) => {
                                            setPasswordInput(e.target.value);
                                            setPasswordError('');
                                        }}
                                        placeholder="Enter creator password"
                                        className={`w-full p-3 border-2 rounded-xl text-center focus:outline-none mb-2 ${passwordError ? 'border-red-300 focus:border-red-500' : 'border-gray-300 focus:border-purple-500'}`}
                                        autoFocus={true}
                                        onKeyDown={(e) => e.key === 'Enter' ? verifyPassword() : e.key === 'Escape' ? setShowPasswordPrompt(false) : null}
                                    />
                                    {passwordError && <p className="text-red-500 text-sm text-center mb-4">{passwordError}</p>}
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setShowPasswordPrompt(false)}
                                            className="flex-1 bg-gray-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-gray-600 transition-colors"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={verifyPassword}
                                            className="flex-1 bg-blue-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-blue-600 transition-colors"
                                        >
                                            Verify
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Customizer Modal */}
                        {showCustomizer && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 overflow-y-auto">
                                <div className="bg-white rounded-3xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                    <h2 className="text-2xl font-bold text-center mb-6 text-gray-800">
                                        {isEditMode ? '✏️ Edit Your Game' : '🎨 Customize Your Game'}
                                    </h2>
                                    
                                    {/* Game Title Input */}
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Game Title</label>
                                        <input
                                            type="text"
                                            value={gameTitle}
                                            onChange={(e) => setGameTitle(e.target.value)}
                                            className="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none"
                                            placeholder="Enter your game title"
                                        />
                                    </div>

                                    {/* Game Description Input */}
                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Game Description</label>
                                        <input
                                            type="text"
                                            value={gameDescription}
                                            onChange={(e) => setGameDescription(e.target.value)}
                                            className="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none"
                                            placeholder="Enter your game description"
                                        />
                                    </div>

                                    {/* Categories Section */}
                                    <div className="mb-6">
                                        <div className="flex justify-between items-center mb-3">
                                            <label className="block text-sm font-medium text-gray-700">Categories ({customCategories.length})</label>
                                            <button
                                                onClick={addCustomCategory}
                                                className="bg-green-500 text-white p-2 rounded-full hover:bg-green-600 transition-colors"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                    <path d="M5 12h14"/>
                                                    <path d="M12 5v14"/>
                                                </svg>
                                            </button>
                                        </div>
                                        <div className="space-y-3 max-h-60 overflow-y-auto">
                                            {customCategories.map((category, index) => (
                                                <div key={index} className="flex gap-2">
                                                    <input
                                                        type="text"
                                                        value={category}
                                                        onChange={(e) => updateCustomCategory(index, e.target.value)}
                                                        className="flex-1 p-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none"
                                                        placeholder={`Category ${index + 1}`}
                                                    />
                                                    {customCategories.length > 1 && (
                                                        <button
                                                            onClick={() => removeCustomCategory(index)}
                                                            className="bg-red-500 text-white p-3 rounded-xl hover:bg-red-600 transition-colors"
                                                        >
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                                <path d="M3 6h18"/>
                                                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                                                                <path d="M8 6V4c0-1 1-2 2-2h4c-1 0 2 1 2 2v2"/>
                                                            </svg>
                                                        </button>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Password Input */}
                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Creator Password (for editing later)</label>
                                        <div className="relative">
                                            <input
                                                type={showPassword ? 'text' : 'password'}
                                                value={creatorPassword}
                                                onChange={(e) => setCreatorPassword(e.target.value)}
                                                className="w-full p-3 pr-12 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none"
                                                placeholder="Enter a password to protect your game"
                                            />
                                            <button
                                                type="button"
                                                onClick={() => setShowPassword(!showPassword)}
                                                className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                                            >
                                                {showPassword ? (
                                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                        <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/>
                                                        <path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/>
                                                        <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/>
                                                        <line x1="2" x2="22" y1="2" y2="22"/>
                                                    </svg>
                                                ) : (
                                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                        <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                                                        <circle cx="12" cy="12" r="3"/>
                                                    </svg>
                                                )}
                                            </button>
                                        </div>
                                    </div>

                                    {/* Share Link Display */}
                                    {shareLink && (
                                        <div className="mb-6 p-4 bg-green-50 border-2 border-green-200 rounded-xl">
                                            <h3 className="font-semibold text-green-800 mb-2">🎉 Your Share Link is Ready!</h3>
                                            <div className="flex gap-2">
                                                <input 
                                                    type="text" 
                                                    value={shareLink} 
                                                    readOnly 
                                                    className="flex-1 p-2 bg-white border border-green-300 rounded-lg text-sm" 
                                                />
                                                <button
                                                    onClick={copyShareLink}
                                                    className="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors"
                                                >
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                                                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    {/* Action Buttons */}
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => {
                                                setShowCustomizer(false);
                                                setIsEditMode(false);
                                            }}
                                            className="flex-1 bg-gray-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-gray-600 transition-colors"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={applyCustomization}
                                            className="flex-1 bg-purple-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-purple-600 transition-colors"
                                        >
                                            Apply Changes
                                        </button>
                                        <button
                                            onClick={isEditMode ? updateExistingGame : createShareLink}
                                            disabled={isCreatingLink}
                                            className="flex-1 bg-blue-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-blue-600 transition-colors disabled:opacity-50"
                                        >
                                            {isCreatingLink ? 'Saving...' : isEditMode ? 'Update Game' : 'Create Share Link'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Progress Bar */}
                        {(!cameraIndex && !previewIndex && !showNameInput && !showCustomizer) && (
                            <div className="bg-white border-b border-gray-200 px-6 py-4">
                                <div className="bg-gray-200 rounded-full h-3 overflow-hidden">
                                    <div 
                                        className="bg-gradient-to-r from-purple-500 to-pink-500 h-full transition-all duration-500"
                                        style={{ width: `${(completedCount / categories.length) * 100}%` }}
                                    />
                                </div>
                                <p className="text-center text-xs text-gray-600 mt-2">
                                    {completedCount === 0 ? "Start by taking your first selfie!" :
                                     completedCount < categories.length ? "Keep going! Take more selfies and tap completed photos to view." :
                                     "Congratulations! You completed the selfie bingo!"}
                                </p>
                            </div>
                        )}

                        {/* Name Input Modal */}
                        {showNameInput && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                                <div className="bg-white rounded-3xl p-6 max-w-sm w-full">
                                    <h2 className="text-xl font-bold text-center mb-4 text-gray-800">📝 Who's in the photo?</h2>
                                    <input
                                        type="text"
                                        value={nameInput}
                                        onChange={(e) => setNameInput(e.target.value)}
                                        placeholder="Enter their name (optional)"
                                        className="w-full p-3 border-2 border-gray-300 rounded-xl text-center focus:border-purple-500 focus:outline-none mb-4"
                                        autoFocus={true}
                                        onKeyDown={(e) => e.key === 'Enter' ? saveName() : e.key === 'Escape' ? skipName() : null}
                                    />
                                    <div className="flex gap-3">
                                        <button
                                            onClick={skipName}
                                            className="flex-1 bg-gray-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-gray-600 transition-colors"
                                        >
                                            Skip
                                        </button>
                                        <button
                                            onClick={saveName}
                                            className="flex-1 bg-purple-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-purple-600 transition-colors"
                                        >
                                            Save
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Photo Preview */}
                        {(previewIndex !== null) && (
                            <div className="fixed inset-0 bg-black z-50 flex flex-col" onClick={() => setPreviewIndex(null)}>
                                <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-4 text-white">
                                    <h2 className="text-lg font-semibold text-center">{categories[previewIndex]}</h2>
                                    {names[previewIndex] && <p className="text-center text-indigo-100 mt-1 font-medium">with {names[previewIndex]}</p>}
                                </div>
                                <div className="flex-1 flex items-center justify-center p-4">
                                    <img
                                        src={photos[previewIndex]}
                                        alt={categories[previewIndex]}
                                        className="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
                                        onClick={(e) => e.stopPropagation()}
                                    />
                                </div>
                            </div>
                        )}

                        {/* Camera View */}
                        {(cameraIndex !== null) && (
                            <div className="fixed inset-0 bg-black z-50 flex flex-col">
                                <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-4 text-white">
                                    <h2 className="text-lg font-semibold text-center">{categories[cameraIndex]}</h2>
                                    <p className="text-center text-sm text-indigo-100 mt-1">Take a selfie with someone who matches this!</p>
                                </div>
                                
                                <div className="flex-1 flex items-center justify-center p-4">
                                    {useFileInput ? (
                                        <div className="text-center">
                                            <div className="bg-white rounded-2xl p-8 max-w-sm">
                                                <div className="text-6xl mb-4">📷</div>
                                                <p className="text-gray-700 mb-4">Choose a photo from your device</p>
                                                <input
                                                    ref={fileInputRef}
                                                    type="file"
                                                    accept="image/*"
                                                    onChange={handleFileInput}
                                                    style={{ display: 'none' }}
                                                />
                                                <div className="flex gap-3">
                                                    <button
                                                        onClick={() => fileInputRef.current?.click()}
                                                        className="flex-1 bg-purple-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-purple-600 transition-colors"
                                                    >
                                                        Choose Photo
                                                    </button>
                                                    <button
                                                        onClick={stopCamera}
                                                        className="flex-1 bg-gray-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-gray-600 transition-colors"
                                                    >
                                                        Cancel
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                            <video
                                                ref={videoRef}
                                                autoPlay
                                                playsInline
                                                className="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
                                            />
                                            <div className="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex gap-4">
                                                <button
                                                    onClick={capturePhoto}
                                                    className="bg-white p-4 rounded-full shadow-lg hover:bg-gray-100 transition-colors"
                                                >
                                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M12 15.5c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3z"/>
                                                        <path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/>
                                                    </svg>
                                                </button>
                                                <button
                                                    onClick={stopCamera}
                                                    className="bg-red-500 text-white px-6 py-3 rounded-full font-semibold hover:bg-red-600 transition-colors"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Bingo Grid */}
                        {(!cameraIndex && !previewIndex && !showNameInput) && (
                            <div className="p-6 pb-8">
                                <div className="grid grid-cols-3 gap-3">
                                    {categories.map((category, index) => (
                                        <div
                                            key={index}
                                            className={`relative border-2 rounded-xl p-3 flex flex-col items-center justify-center text-center transition-all min-h-[120px]
                                                ${completedBoxes.has(index) ? 'border-green-500 bg-green-50 cursor-pointer hover:border-green-600' : 'border-gray-300 bg-gray-50 hover:border-purple-400 hover:bg-purple-50'}`}
                                            onClick={() => completedBoxes.has(index) && setPreviewIndex(index)}
                                        >
                                            {/* Photo background */}
                                            {(completedBoxes.has(index) && photos[index]) && (
                                                <img
                                                    src={photos[index]}
                                                    alt={category}
                                                    className="absolute inset-0 w-full h-full object-cover rounded-xl"
                                                />
                                            )}
                                            
                                            {/* Check mark */}
                                            {completedBoxes.has(index) && (
                                                <div className="absolute top-2 right-2 bg-green-500 rounded-full p-1 text-white text-xs">
                                                    ✓
                                                </div>
                                            )}

                                            {/* Name label */}
                                            {(completedBoxes.has(index) && names[index]) && (
                                                <div className="absolute bottom-1 left-1 right-1 bg-black/70 text-white text-xs px-2 py-1 rounded text-center truncate">
                                                    {names[index]}
                                                </div>
                                            )}

                                            {/* Category text */}
                                            <span className={`text-xs font-medium z-10 ${completedBoxes.has(index) ? 'text-white bg-black/50 px-2 py-1 rounded' : 'text-gray-700'}`}>
                                                {category}
                                            </span>

                                            {/* Camera button */}
                                            {!completedBoxes.has(index) && (
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        startCamera(index);
                                                    }}
                                                    className="mt-2 p-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition-colors z-10"
                                                >
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M12 15.5c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3z"/>
                                                        <path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/>
                                                    </svg>
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Hidden elements */}
                        <canvas ref={canvasRef} style={{ display: 'none' }} />
                        <input
                            ref={fileInputRef}
                            type="file"
                            accept="image/*"
                            onChange={handleFileInput}
                            style={{ display: 'none' }}
                        />
                    </div>
                </div>
            );
        }

        ReactDOM.render(<HumanBingoGame />, document.getElementById('root'));
    </script>
</body>
</html>
