<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Bingo Selfie Game</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase v8 (compatible) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // ðŸ”¥ Your Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCKVkzw8bHYiaqwS6J0xrTplhnXYdEQwiQ",
            authDomain: "human-bingo-game.firebaseapp.com",
            projectId: "human-bingo-game",
            storageBucket: "human-bingo-game.firebasestorage.app",
            messagingSenderId: "133740150923",
            appId: "1:133740150923:web:0266b47cb2cc4e0d1e548e"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Lucide Icons as React components
        const Camera = ({ size = 24 }) => React.createElement('svg', {
            width: size, height: size, viewBox: '0 0 24 24', fill: 'currentColor'
        }, [
            React.createElement('path', { 
                key: 1, 
                d: 'M12 15.5c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3z'
            }),
            React.createElement('path', { 
                key: 2, 
                d: 'M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z'
            })
        ]);

        const Settings = () => React.createElement('svg', {
            width: 16, height: 16, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, [
            React.createElement('circle', { key: 1, cx: 12, cy: 12, r: 3 }),
            React.createElement('path', { key: 2, d: 'm12 1 2.09 5.26L22 9l-5.26 2.09L14 22l-2.09-5.26L2 14l5.26-2.09L10 2z' })
        ]);

        const RotateCcw = () => React.createElement('svg', {
            width: 16, height: 16, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, [
            React.createElement('path', { key: 1, d: 'M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8' }),
            React.createElement('path', { key: 2, d: 'M3 3v5h5' })
        ]);

        const Plus = () => React.createElement('svg', {
            width: 16, height: 16, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, [
            React.createElement('path', { key: 1, d: 'M5 12h14' }),
            React.createElement('path', { key: 2, d: 'M12 5v14' })
        ]);

        const Trash2 = () => React.createElement('svg', {
            width: 16, height: 16, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, [
            React.createElement('path', { key: 1, d: 'M3 6h18' }),
            React.createElement('path', { key: 2, d: 'M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6' }),
            React.createElement('path', { key: 3, d: 'M8 6V4c0-1 1-2 2-2h4c-1 0 2 1 2 2v2' })
        ]);

        const Check = () => React.createElement('svg', {
            width: 12, height: 12, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, [
            React.createElement('polyline', { key: 1, points: '20,6 9,17 4,12' })
        ]);

        const Copy = () => React.createElement('svg', {
            width: 16, height: 16, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, [
            React.createElement('rect', { key: 1, width: 14, height: 14, x: 8, y: 8, rx: 2, ry: 2 }),
            React.createElement('path', { key: 2, d: 'M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2' })
        ]);

        const Eye = () => React.createElement('svg', {
            width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, [
            React.createElement('path', { key: 1, d: 'M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z' }),
            React.createElement('circle', { key: 2, cx: 12, cy: 12, r: 3 })
        ]);

        const EyeOff = () => React.createElement('svg', {
            width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, [
            React.createElement('path', { key: 1, d: 'M9.88 9.88a3 3 0 1 0 4.24 4.24' }),
            React.createElement('path', { key: 2, d: 'M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68' }),
            React.createElement('path', { key: 3, d: 'M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61' }),
            React.createElement('line', { key: 4, x1: 2, x2: 22, y1: 2, y2: 22 })
        ]);

        const { useState, useRef, useEffect } = React;

        const HumanBingoGame = () => {
            // Default categories
            const defaultCategories = [
                "Nervous about the future",
                "Nature Lover", 
                "Thinks their future job doesn't exist yet",
                "Secretly excited to grow older",
                "Would choose more free time over more money",
                "Believes our generation will do better",
                "Has a pet",
                "Binge watches shows",
                "Likes to read"
            ];

            const [categories, setCategories] = useState(defaultCategories);
            const [cameraIndex, setCameraIndex] = useState(null);
            const [completedBoxes, setCompletedBoxes] = useState(new Set());
            const [photos, setPhotos] = useState({});
            const [names, setNames] = useState({});
            const [previewIndex, setPreviewIndex] = useState(null);
            const [screenSize, setScreenSize] = useState('large');
            const [nameInput, setNameInput] = useState('');
            const [showNameInput, setShowNameInput] = useState(false);
            const [pendingPhotoIndex, setPendingPhotoIndex] = useState(null);
            
            // Customization states
            const [showCustomizer, setShowCustomizer] = useState(false);
            const [customCategories, setCustomCategories] = useState(['']);
            const [gameTitle, setGameTitle] = useState('Human Bingo Selfie');
            const [gameDescription, setGameDescription] = useState('Take selfies with people to complete your bingo!');
            const [creatorPassword, setCreatorPassword] = useState('');
            const [showPassword, setShowPassword] = useState(false);
            const [shareLink, setShareLink] = useState('');
            const [isCreatingLink, setIsCreatingLink] = useState(false);
            const [gameId, setGameId] = useState(null);
            const [isCustomGame, setIsCustomGame] = useState(false);
            const [isEditMode, setIsEditMode] = useState(false);
            const [showPasswordPrompt, setShowPasswordPrompt] = useState(false);
            const [passwordInput, setPasswordInput] = useState('');
            const [passwordError, setPasswordError] = useState('');
            
            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const fileInputRef = useRef(null);
            const [stream, setStream] = useState(null);
            const [useFileInput, setUseFileInput] = useState(false);

            // Load game on component mount
            useEffect(() => {
                const updateScreenSize = () => {
                    const width = window.innerWidth;
                    if (width < 350) setScreenSize('tiny');
                    else if (width < 480) setScreenSize('small');
                    else if (width < 768) setScreenSize('medium');
                    else setScreenSize('large');
                };

                const loadGameFromURL = async () => {
                    try {
                        const urlParams = new URLSearchParams(window.location.search);
                        const gameIdParam = urlParams.get('game');
                        
                        if (gameIdParam) {
                            console.log('Loading game:', gameIdParam);
                            const gameDoc = await db.collection('games').doc(gameIdParam).get();
                            if (gameDoc.exists) {
                                const gameData = gameDoc.data();
                                setGameId(gameIdParam);
                                setIsCustomGame(true);
                                setGameTitle(gameData.title || 'Custom Human Bingo');
                                setGameDescription(gameData.description || 'Custom selfie bingo game!');
                                setCategories(gameData.categories || defaultCategories);
                                console.log('Game loaded successfully');
                            } else {
                                console.log('Game not found');
                            }
                        }
                    } catch (error) {
                        console.log('Could not load custom game:', error);
                    }
                };

                updateScreenSize();
                loadGameFromURL();
                window.addEventListener('resize', updateScreenSize);
                return () => window.removeEventListener('resize', updateScreenSize);
            }, []);

            // Get layout configuration
            const getLayoutConfig = () => {
                const numCategories = categories.length;
                const cols = numCategories <= 4 ? 2 : numCategories <= 9 ? 3 : numCategories <= 16 ? 4 : 5;
                
                switch (screenSize) {
                    case 'tiny':
                    case 'small':
                        return { grid: `grid-cols-${Math.min(cols, 2)}`, spacing: 'gap-3', textSize: 'text-xs', buttonSize: 'p-2' };
                    case 'medium':
                        return { grid: `grid-cols-${Math.min(cols, 3)}`, spacing: 'gap-2', textSize: 'text-xs', buttonSize: 'p-2' };
                    default:
                        return { grid: `grid-cols-${cols}`, spacing: 'gap-3', textSize: 'text-xs', buttonSize: 'p-2' };
                }
            };

            const layoutConfig = getLayoutConfig();
            const hasCustomCategories = JSON.stringify(categories) !== JSON.stringify(defaultCategories);
            const completedCount = completedBoxes.size;
            const isWinner = completedCount === categories.length;

            // Camera functions
            const startCamera = async (index) => {
                setCameraIndex(index);
                try {
                    const mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
                    setStream(mediaStream);
                    if (videoRef.current) videoRef.current.srcObject = mediaStream;
                    setUseFileInput(false);
                } catch (error) {
                    console.log('Camera failed, using file input');
                    setUseFileInput(true);
                }
            };

            const stopCamera = () => {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    setStream(null);
                }
                setCameraIndex(null);
                setUseFileInput(false);
            };

            const capturePhoto = () => {
                if (videoRef.current && canvasRef.current) {
                    const canvas = canvasRef.current;
                    const video = videoRef.current;
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(video, 0, 0);
                    
                    const photoDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    setPhotos(prev => ({ ...prev, [cameraIndex]: photoDataUrl }));
                    setPendingPhotoIndex(cameraIndex);
                    setShowNameInput(true);
                    stopCamera();
                }
            };

            const handleFileInput = (event) => {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setPhotos(prev => ({ ...prev, [cameraIndex]: e.target.result }));
                        setPendingPhotoIndex(cameraIndex);
                        setShowNameInput(true);
                        setCameraIndex(null);
                        setUseFileInput(false);
                    };
                    reader.readAsDataURL(file);
                }
                event.target.value = '';
            };

            // Game functions
            const saveName = () => {
                if (pendingPhotoIndex !== null) {
                    setNames(prev => ({ ...prev, [pendingPhotoIndex]: nameInput.trim() }));
                    setCompletedBoxes(prev => new Set([...prev, pendingPhotoIndex]));
                    setNameInput('');
                    setShowNameInput(false);
                    setPendingPhotoIndex(null);
                }
            };

            const skipName = () => {
                if (pendingPhotoIndex !== null) {
                    setCompletedBoxes(prev => new Set([...prev, pendingPhotoIndex]));
                    setNameInput('');
                    setShowNameInput(false);
                    setPendingPhotoIndex(null);
                }
            };

            const resetGame = () => {
                setCompletedBoxes(new Set());
                setPhotos({});
                setNames({});
                setPreviewIndex(null);
                setShowNameInput(false);
                setNameInput('');
                setPendingPhotoIndex(null);
                stopCamera();
            };

            // Customization functions
            const openCustomizer = () => {
                setCustomCategories([...categories]);
                setShowCustomizer(true);
            };

            const addCustomCategory = () => {
                setCustomCategories([...customCategories, '']);
            };

            const removeCustomCategory = (index) => {
                if (customCategories.length > 1) {
                    setCustomCategories(customCategories.filter((_, i) => i !== index));
                }
            };

            const updateCustomCategory = (index, value) => {
                const newCategories = [...customCategories];
                newCategories[index] = value;
                setCustomCategories(newCategories);
            };

            const createShareLink = async () => {
                if (!creatorPassword.trim()) {
                    alert('Please enter a password to secure your custom game.');
                    return;
                }

                const validCategories = customCategories.filter(cat => cat.trim() !== '');
                if (validCategories.length < 4) {
                    alert('Please add at least 4 categories for your game.');
                    return;
                }

                setIsCreatingLink(true);
                console.log('Creating share link...');
                
                try {
                    const gameData = {
                        title: gameTitle,
                        description: gameDescription,
                        categories: validCategories,
                        password: creatorPassword,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
                    };

                    console.log('Saving game data:', gameData);
                    const docRef = await db.collection('games').add(gameData);
                    console.log('Game saved with ID:', docRef.id);
                    
                    const newShareLink = `${window.location.origin}${window.location.pathname}?game=${docRef.id}`;
                    setShareLink(newShareLink);
                    setGameId(docRef.id);
                    console.log('Share link created:', newShareLink);
                } catch (error) {
                    console.error('Error creating share link:', error);
                    alert('Failed to create share link: ' + error.message);
                } finally {
                    setIsCreatingLink(false);
                }
            };

            const copyShareLink = () => {
                navigator.clipboard.writeText(shareLink);
                alert('Share link copied to clipboard!');
            };

            const applyCustomization = () => {
                const validCategories = customCategories.filter(cat => cat.trim() !== '');
                if (validCategories.length < 4) {
                    alert('Please add at least 4 categories for your game.');
                    return;
                }
                setCategories(validCategories);
                setCompletedBoxes(new Set());
                setPhotos({});
                setNames({});
                setShowCustomizer(false);
            };

            return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 p-4 pb-8" }, [
                React.createElement('div', { 
                    key: 'main', 
                    className: `${screenSize === 'tiny' ? 'max-w-sm' : 'max-w-md'} mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden` 
                }, [
                    // Header
                    React.createElement('div', { key: 'header', className: "bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white" }, [
                        React.createElement('h1', { 
                            key: 'title', 
                            className: `${screenSize === 'tiny' ? 'text-xl' : 'text-2xl'} font-bold text-center mb-2` 
                        }, `ðŸ“¸ ${gameTitle}`),
                        React.createElement('p', { 
                            key: 'desc', 
                            className: `text-center text-indigo-100 ${screenSize === 'tiny' ? 'text-xs' : 'text-sm'}` 
                        }, screenSize === 'tiny' ? 'Take selfies with friends!' : gameDescription),
                        React.createElement('div', { key: 'controls', className: "mt-4 flex justify-between items-center" }, [
                            React.createElement('span', { 
                                key: 'progress', 
                                className: `${screenSize === 'tiny' ? 'text-xs' : 'text-sm'} bg-white/20 px-3 py-1 rounded-full` 
                            }, `${completedCount}/${categories.length} completed`),
                            React.createElement('div', { key: 'buttons', className: "flex gap-2" }, [
                                React.createElement('button', {
                                    key: 'settings',
                                    onClick: openCustomizer,
                                    className: "p-2 bg-blue-500/20 border border-blue-300/30 rounded-full hover:bg-blue-500/30 transition-colors"
                                }, React.createElement(Settings)),
                                isCustomGame && React.createElement('button', {
                                    key: 'edit',
                                    onClick: promptForPassword,
                                    title: "Edit this custom game",
                                    className: "p-2 bg-green-500/20 border border-green-300/30 rounded-full hover:bg-green-500/30 transition-colors"
                                }, React.createElement(Edit3)),
                                React.createElement('button', {
                                    key: 'reset',
                                    onClick: resetGame,
                                    className: "p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors"
                                }, React.createElement(RotateCcw))
                            ])
                        ])
                    ]),

                    // Customizer Modal
                    showCustomizer && React.createElement('div', { 
                        key: 'customizer', 
                        className: "fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 overflow-y-auto" 
                    }, React.createElement('div', { className: "bg-white rounded-3xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto" }, [
                        React.createElement('h2', { key: 'title', className: "text-2xl font-bold text-center mb-6 text-gray-800" }, 
                            isEditMode ? 'âœï¸ Edit Your Game' : 'ðŸŽ¨ Customize Your Game'),
                        
                        // Game Title Input
                        React.createElement('div', { key: 'title-input', className: "mb-4" }, [
                            React.createElement('label', { key: 'label', className: "block text-sm font-medium text-gray-700 mb-2" }, 'Game Title'),
                            React.createElement('input', {
                                key: 'input',
                                type: 'text',
                                value: gameTitle,
                                onChange: (e) => setGameTitle(e.target.value),
                                className: "w-full p-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none",
                                placeholder: "Enter your game title"
                            })
                        ]),

                        // Game Description Input
                        React.createElement('div', { key: 'desc-input', className: "mb-6" }, [
                            React.createElement('label', { key: 'label', className: "block text-sm font-medium text-gray-700 mb-2" }, 'Game Description'),
                            React.createElement('input', {
                                key: 'input',
                                type: 'text',
                                value: gameDescription,
                                onChange: (e) => setGameDescription(e.target.value),
                                className: "w-full p-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none",
                                placeholder: "Enter your game description"
                            })
                        ]),

                        // Categories Section
                        React.createElement('div', { key: 'categories', className: "mb-6" }, [
                            React.createElement('div', { key: 'header', className: "flex justify-between items-center mb-3" }, [
                                React.createElement('label', { key: 'label', className: "block text-sm font-medium text-gray-700" }, `Categories (${customCategories.length})`),
                                React.createElement('button', {
                                    key: 'add',
                                    onClick: addCustomCategory,
                                    className: "bg-green-500 text-white p-2 rounded-full hover:bg-green-600 transition-colors"
                                }, React.createElement(Plus))
                            ]),
                            React.createElement('div', { key: 'list', className: "space-y-3 max-h-60 overflow-y-auto" }, 
                                customCategories.map((category, index) => 
                                    React.createElement('div', { key: index, className: "flex gap-2" }, [
                                        React.createElement('input', {
                                            key: 'input',
                                            type: 'text',
                                            value: category,
                                            onChange: (e) => updateCustomCategory(index, e.target.value),
                                            className: "flex-1 p-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none",
                                            placeholder: `Category ${index + 1}`
                                        }),
                                        customCategories.length > 1 && React.createElement('button', {
                                            key: 'delete',
                                            onClick: () => removeCustomCategory(index),
                                            className: "bg-red-500 text-white p-3 rounded-xl hover:bg-red-600 transition-colors"
                                        }, React.createElement(Trash2))
                                    ])
                                )
                            )
                        ]),

                        // Password Input
                        React.createElement('div', { key: 'password', className: "mb-6" }, [
                            React.createElement('label', { key: 'label', className: "block text-sm font-medium text-gray-700 mb-2" }, 'Creator Password (for editing later)'),
                            React.createElement('div', { key: 'wrapper', className: "relative" }, [
                                React.createElement('input', {
                                    key: 'input',
                                    type: showPassword ? 'text' : 'password',
                                    value: creatorPassword,
                                    onChange: (e) => setCreatorPassword(e.target.value),
                                    className: "w-full p-3 pr-12 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none",
                                    placeholder: "Enter a password to protect your game"
                                }),
                                React.createElement('button', {
                                    key: 'toggle',
                                    type: 'button',
                                    onClick: () => setShowPassword(!showPassword),
                                    className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                                }, showPassword ? React.createElement(EyeOff) : React.createElement(Eye))
                            ])
                        ]),

                        // Share Link Display
                        shareLink && React.createElement('div', { key: 'sharelink', className: "mb-6 p-4 bg-green-50 border-2 border-green-200 rounded-xl" }, [
                            React.createElement('h3', { key: 'title', className: "font-semibold text-green-800 mb-2" }, 'ðŸŽ‰ Your Share Link is Ready!'),
                            React.createElement('div', { key: 'link', className: "flex gap-2" }, [
                                React.createElement('input', { 
                                    key: 'input',
                                    type: 'text', 
                                    value: shareLink, 
                                    readOnly: true, 
                                    className: "flex-1 p-2 bg-white border border-green-300 rounded-lg text-sm" 
                                }),
                                React.createElement('button', {
                                    key: 'copy',
                                    onClick: copyShareLink,
                                    className: "bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors"
                                }, React.createElement(Copy))
                            ])
                        ]),

                        // Action Buttons
                        React.createElement('div', { key: 'actions', className: "flex gap-3" }, [
                            React.createElement('button', {
                                key: 'cancel',
                                onClick: () => {
                                    setShowCustomizer(false);
                                    setIsEditMode(false);
                                },
                                className: "flex-1 bg-gray-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-gray-600 transition-colors"
                            }, 'Cancel'),
                            React.createElement('button', {
                                key: 'apply',
                                onClick: applyCustomization,
                                className: "flex-1 bg-purple-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-purple-600 transition-colors"
                            }, 'Apply Changes'),
                            React.createElement('button', {
                                key: 'share',
                                onClick: isEditMode ? updateExistingGame : createShareLink,
                                disabled: isCreatingLink,
                                className: "flex-1 bg-blue-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-blue-600 transition-colors disabled:opacity-50"
                            }, isCreatingLink ? 'Saving...' : isEditMode ? 'Update Game' : 'Create Share Link')
                        ])
                    ])),

                    // Progress Bar
                    (!cameraIndex && !previewIndex && !showNameInput && !showCustomizer) && React.createElement('div', { 
                        key: 'progress', 
                        className: "sticky top-0 bg-white border-b border-gray-200 px-6 py-4 z-10" 
                    }, [
                        React.createElement('div', { key: 'bar', className: "bg-gray-200 rounded-full h-3 overflow-hidden" },
                            React.createElement('div', { 
                                className: "bg-gradient-to-r from-purple-500 to-pink-500 h-full transition-all duration-500",
                                style: { width: `${(completedCount / categories.length) * 100}%` }
                            })
                        ),
                        React.createElement('p', { 
                            key: 'text', 
                            className: `text-center ${layoutConfig.textSize} text-gray-600 mt-2`
                        }, 
                            completedCount === 0 ? "Start by taking your first selfie!" :
                            completedCount < categories.length ? "Keep going! Take more selfies and tap completed photos to view." :
                            "Congratulations! You completed the selfie bingo!"
                        )
                    ]),

                    // Name Input Modal
                    showNameInput && React.createElement('div', { 
                        key: 'nameinput', 
                        className: "fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" 
                    }, React.createElement('div', { className: "bg-white rounded-3xl p-6 max-w-sm w-full" }, [
                        React.createElement('h2', { key: 'title', className: "text-xl font-bold text-center mb-4 text-gray-800" }, 'ðŸ“ Who\'s in the photo?'),
                        React.createElement('input', {
                            key: 'input',
                            type: 'text',
                            value: nameInput,
                            onChange: (e) => setNameInput(e.target.value),
                            placeholder: "Enter their name (optional)",
                            className: "w-full p-3 border-2 border-gray-300 rounded-xl text-center focus:border-purple-500 focus:outline-none mb-4",
                            autoFocus: true,
                            onKeyDown: (e) => e.key === 'Enter' ? saveName() : e.key === 'Escape' ? skipName() : null
                        }),
                        React.createElement('div', { key: 'buttons', className: "flex gap-3" }, [
                            React.createElement('button', {
                                key: 'skip',
                                onClick: skipName,
                                className: "flex-1 bg-gray-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-gray-600 transition-colors"
                            }, 'Skip'),
                            React.createElement('button', {
                                key: 'save',
                                onClick: saveName,
                                className: "flex-1 bg-purple-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-purple-600 transition-colors"
                            }, 'Save')
                        ])
                    ])),

                    // Photo Preview
                    (previewIndex !== null) && React.createElement('div', { 
                        key: 'preview', 
                        className: "fixed inset-0 bg-black z-50 flex flex-col",
                        onClick: () => setPreviewIndex(null)
                    }, [
                        React.createElement('div', { key: 'header', className: "bg-gradient-to-r from-indigo-600 to-purple-600 p-4 text-white" }, [
                            React.createElement('h2', { key: 'title', className: "text-lg font-semibold text-center" }, categories[previewIndex]),
                            names[previewIndex] && React.createElement('p', { key: 'name', className: "text-center text-indigo-100 mt-1 font-medium" }, `with ${names[previewIndex]}`)
                        ]),
                        React.createElement('div', { key: 'image', className: "flex-1 flex items-center justify-center p-4" },
                            React.createElement('img', {
                                src: photos[previewIndex],
                                alt: categories[previewIndex],
                                className: "max-w-full max-h-full object-contain rounded-lg shadow-2xl",
                                onClick: (e) => e.stopPropagation()
                            })
                        )
                    ]),

                    // Camera View
                    (cameraIndex !== null) && React.createElement('div', { 
                        key: 'camera', 
                        className: "fixed inset-0 bg-black z-50 flex flex-col" 
                    }, [
                        React.createElement('div', { key: 'header', className: "bg-gradient-to-r from-indigo-600 to-purple-600 p-4 text-white" }, [
                            React.createElement('h2', { key: 'title', className: "text-lg font-semibold text-center" }, categories[cameraIndex]),
                            React.createElement('p', { key: 'subtitle', className: "text-center text-sm text-indigo-100 mt-1" }, 'Take a selfie with someone who matches this!')
                        ]),
                        
                        React.createElement('div', { key: 'content', className: "flex-1 flex items-center justify-center p-4" },
                            useFileInput ? 
                                React.createElement('div', { className: "text-center" },
                                    React.createElement('div', { className: "bg-white rounded-2xl p-8 max-w-sm" }, [
                                        React.createElement(Camera, { key: 'icon' }),
                                        React.createElement('p', { key: 'text', className: "text-gray-700 mb-4 mt-4" }, 'Choose a photo from your device'),
                                        React.createElement('input', {
                                            key: 'input',
                                            ref: fileInputRef,
                                            type: 'file',
                                            accept: 'image/*',
                                            onChange: handleFileInput,
                                            style: { display: 'none' }
                                        }),
                                        React.createElement('div', { key: 'buttons', className: "flex gap-3" }, [
                                            React.createElement('button', {
                                                key: 'choose',
                                                onClick: () => fileInputRef.current?.click(),
                                                className: "flex-1 bg-purple-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-purple-600 transition-colors"
                                            }, 'Choose Photo'),
                                            React.createElement('button', {
                                                key: 'cancel',
                                                onClick: stopCamera,
                                                className: "flex-1 bg-gray-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-gray-600 transition-colors"
                                            }, 'Cancel')
                                        ])
                                    ])
                                ) :
                                [
                                    React.createElement('video', {
                                        key: 'video',
                                        ref: videoRef,
                                        autoPlay: true,
                                        playsInline: true,
                                        className: "max-w-full max-h-full object-contain rounded-lg shadow-2xl"
                                    }),
                                    React.createElement('div', { key: 'controls', className: "absolute bottom-8 left-1/2 transform -translate-x-1/2 flex gap-4" }, [
                                        React.createElement('button', {
                                            key: 'capture',
                                            onClick: capturePhoto,
                                            className: "bg-white p-4 rounded-full shadow-lg hover:bg-gray-100 transition-colors"
                                        }, React.createElement(Camera, { size: screenSize === 'tiny' ? 20 : 16 })),
                                        React.createElement('button', {
                                            key: 'cancel',
                                            onClick: stopCamera,
                                            className: "bg-red-500 text-white px-6 py-3 rounded-full font-semibold hover:bg-red-600 transition-colors"
                                        }, 'Cancel')
                                    ])
                                ]
                        )
                    ]),

                    // Bingo Grid
                    (!cameraIndex && !previewIndex && !showNameInput && !showCustomizer) && React.createElement('div', { 
                        key: 'grid', 
                        className: "p-6 pb-8" 
                    }, React.createElement('div', { className: `grid ${layoutConfig.grid} ${layoutConfig.spacing}` }, 
                        categories.map((category, index) => 
                            React.createElement('div', {
                                key: index,
                                className: `relative aspect-square border-2 rounded-xl p-3 flex flex-col items-center justify-center text-center transition-all
                                    ${completedBoxes.has(index) ? 'border-green-500 bg-green-50 cursor-pointer hover:border-green-600' : 'border-gray-300 bg-gray-50 hover:border-purple-400 hover:bg-purple-50'}
                                    ${screenSize === 'tiny' ? 'min-h-[120px]' : ''}`,
                                onClick: () => completedBoxes.has(index) && setPreviewIndex(index)
                            }, [
                                // Photo background
                                (completedBoxes.has(index) && photos[index]) && React.createElement('img', {
                                    key: 'photo',
                                    src: photos[index],
                                    alt: category,
                                    className: "absolute inset-0 w-full h-full object-cover rounded-xl"
                                }),
                                
                                // Check mark
                                completedBoxes.has(index) && React.createElement('div', {
                                    key: 'check',
                                    className: "absolute top-2 right-2 bg-green-500 rounded-full p-1"
                                }, React.createElement(Check)),

                                // Name label
                                (completedBoxes.has(index) && names[index]) && React.createElement('div', {
                                    key: 'name',
                                    className: "absolute bottom-1 left-1 right-1 bg-black/70 text-white text-xs px-2 py-1 rounded text-center truncate"
                                }, names[index]),

                                // Category text
                                React.createElement('span', {
                                    key: 'category',
                                    className: `${layoutConfig.textSize} font-medium z-10 ${completedBoxes.has(index) ? 'text-white bg-black/50 px-2 py-1 rounded' : 'text-gray-700'}`
                                }, category),

                                // Camera button
                                !completedBoxes.has(index) && React.createElement('button', {
                                    key: 'camera',
                                    onClick: (e) => {
                                        e.stopPropagation();
                                        startCamera(index);
                                    },
                                    className: `mt-2 ${layoutConfig.buttonSize} bg-purple-500 text-white rounded-full hover:bg-purple-600 transition-colors z-10`
                                }, React.createElement(Camera))
                            ])
                        )
                    )),

                    // Footer
                    React.createElement('div', { key: 'footer', className: "bg-gray-50 px-6 py-4 border-t border-gray-200" },
                        React.createElement('p', { className: "text-center text-xs text-gray-500" }, [
                            'Licensed under ',
                            React.createElement('a', {
                                key: 'link',
                                href: 'https://creativecommons.org/licenses/by-nc/4.0/',
                                target: '_blank',
                                rel: 'noopener noreferrer',
                                className: 'text-purple-600 hover:text-purple-700 underline'
                            }, 'Creative Commons Non-Commercial 4.0')
                        ])
                    ),

                    // Hidden elements
                    React.createElement('canvas', { key: 'canvas', ref: canvasRef, style: { display: 'none' } }),
                    React.createElement('input', {
                        key: 'fileinput',
                        ref: fileInputRef,
                        type: 'file',
                        accept: 'image/*',
                        onChange: handleFileInput,
                        style: { display: 'none' }
                    })
                ])
            const EyeOff = () => React.createElement('svg', {
                width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none',
                stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
            }, [
                React.createElement('path', { key: 1, d: 'M9.88 9.88a3 3 0 1 0 4.24 4.24' }),
                React.createElement('path', { key: 2, d: 'M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68' }),
                React.createElement('path', { key: 3, d: 'M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61' }),
                React.createElement('line', { key: 4, x1: 2, x2: 22, y1: 2, y2: 22 })
            ]);
            const promptForPassword = () => {
                if (!isCustomGame || !gameId) {
                    alert('This is not a custom game that can be edited.');
                    return;
                }
                setPasswordInput('');
                setPasswordError('');
                setShowPasswordPrompt(true);
            };

            const verifyPassword = async () => {
                if (!passwordInput.trim()) {
                    setPasswordError('Please enter a password.');
                    return;
                }

                try {
                    const gameDoc = await db.collection('games').doc(gameId).get();
                    if (gameDoc.exists) {
                        const gameData = gameDoc.data();
                        if (gameData.password === passwordInput.trim()) {
                            setIsEditMode(true);
                            setShowPasswordPrompt(false);
                            setCreatorPassword(passwordInput.trim());
                            openCustomizer();
                        } else {
                            setPasswordError('Incorrect password. Please try again.');
                        }
                    } else {
                        setPasswordError('Game not found.');
                    }
                } catch (error) {
                    console.error('Error verifying password:', error);
                    setPasswordError('Error verifying password. Please try again.');
                }
            };

            const updateExistingGame = async () => {
                if (!gameId || !isEditMode) {
                    createShareLink();
                    return;
                }

                const validCategories = customCategories.filter(cat => cat.trim() !== '');
                if (validCategories.length < 4) {
                    alert('Please add at least 4 categories for your game.');
                    return;
                }

                setIsCreatingLink(true);
                try {
                    const gameData = {
                        title: gameTitle,
                        description: gameDescription,
                        categories: validCategories,
                        password: creatorPassword,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await db.collection('games').doc(gameId).update(gameData);
                    
                    const currentShareLink = `${window.location.origin}${window.location.pathname}?game=${gameId}`;
                    setShareLink(currentShareLink);
                    console.log('Game updated successfully');
                } catch (error) {
                    console.error('Error updating game:', error);
                    alert('Failed to update game: ' + error.message);
                } finally {
                    setIsCreatingLink(false);
                }
            };
        };

        ReactDOM.render(React.createElement(HumanBingoGame), document.getElementById('root'));
    </script>
</body>
</html>
