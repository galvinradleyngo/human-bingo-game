<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Bingo Selfie Game</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef } = React;

        function HumanBingoGame() {
            const defaultCategories = [
                "Nervous about the future",
                "Nature Lover", 
                "Thinks their future job doesn't exist yet",
                "Secretly excited to grow older",
                "Would choose more free time over more money",
                "Believes our generation will do better",
                "Has a pet",
                "Binge watches shows",
                "Likes to read"
            ];

            const [categories] = useState(defaultCategories);
            const [completedBoxes, setCompletedBoxes] = useState(new Set());
            const [photos, setPhotos] = useState({});
            const [names, setNames] = useState({});
            const [cameraIndex, setCameraIndex] = useState(null);
            const [previewIndex, setPreviewIndex] = useState(null);
            const [showNameInput, setShowNameInput] = useState(false);
            const [nameInput, setNameInput] = useState('');
            const [pendingPhotoIndex, setPendingPhotoIndex] = useState(null);

            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const fileInputRef = useRef(null);
            const [stream, setStream] = useState(null);
            const [useFileInput, setUseFileInput] = useState(false);

            const completedCount = completedBoxes.size;

            const startCamera = async (index) => {
                setCameraIndex(index);
                try {
                    const mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
                    setStream(mediaStream);
                    if (videoRef.current) videoRef.current.srcObject = mediaStream;
                    setUseFileInput(false);
                } catch (error) {
                    console.log('Camera failed, using file input');
                    setUseFileInput(true);
                }
            };

            const stopCamera = () => {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    setStream(null);
                }
                setCameraIndex(null);
                setUseFileInput(false);
            };

            const capturePhoto = () => {
                if (videoRef.current && canvasRef.current) {
                    const canvas = canvasRef.current;
                    const video = videoRef.current;
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(video, 0, 0);
                    
                    const photoDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    setPhotos(prev => ({ ...prev, [cameraIndex]: photoDataUrl }));
                    setPendingPhotoIndex(cameraIndex);
                    setShowNameInput(true);
                    stopCamera();
                }
            };

            const handleFileInput = (event) => {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setPhotos(prev => ({ ...prev, [cameraIndex]: e.target.result }));
                        setPendingPhotoIndex(cameraIndex);
                        setShowNameInput(true);
                        setCameraIndex(null);
                        setUseFileInput(false);
                    };
                    reader.readAsDataURL(file);
                }
                event.target.value = '';
            };

            const saveName = () => {
                if (pendingPhotoIndex !== null) {
                    setNames(prev => ({ ...prev, [pendingPhotoIndex]: nameInput.trim() }));
                    setCompletedBoxes(prev => new Set([...prev, pendingPhotoIndex]));
                    setNameInput('');
                    setShowNameInput(false);
                    setPendingPhotoIndex(null);
                }
            };

            const skipName = () => {
                if (pendingPhotoIndex !== null) {
                    setCompletedBoxes(prev => new Set([...prev, pendingPhotoIndex]));
                    setNameInput('');
                    setShowNameInput(false);
                    setPendingPhotoIndex(null);
                }
            };

            const resetGame = () => {
                setCompletedBoxes(new Set());
                setPhotos({});
                setNames({});
                setPreviewIndex(null);
                setShowNameInput(false);
                setNameInput('');
                setPendingPhotoIndex(null);
                stopCamera();
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 p-4 pb-8">
                    <div className="max-w-md mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
                        
                        {/* Header */}
                        <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
                            <h1 className="text-2xl font-bold text-center mb-2">üì∏ Human Bingo Selfie</h1>
                            <p className="text-center text-indigo-100 text-sm">Take selfies with people to complete your bingo!</p>
                            <div className="mt-4 flex justify-between items-center">
                                <span className="text-sm bg-white/20 px-3 py-1 rounded-full">
                                    {completedCount}/{categories.length} completed
                                </span>
                                <button
                                    onClick={resetGame}
                                    className="p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors text-sm"
                                >
                                    Reset
                                </button>
                            </div>
                        </div>

                        {/* Progress Bar */}
                        {(!cameraIndex && !previewIndex && !showNameInput) && (
                            <div className="bg-white border-b border-gray-200 px-6 py-4">
                                <div className="bg-gray-200 rounded-full h-3 overflow-hidden">
                                    <div 
                                        className="bg-gradient-to-r from-purple-500 to-pink-500 h-full transition-all duration-500"
                                        style={{ width: `${(completedCount / categories.length) * 100}%` }}
                                    />
                                </div>
                                <p className="text-center text-xs text-gray-600 mt-2">
                                    {completedCount === 0 ? "Start by taking your first selfie!" :
                                     completedCount < categories.length ? "Keep going! Take more selfies and tap completed photos to view." :
                                     "Congratulations! You completed the selfie bingo!"}
                                </p>
                            </div>
                        )}

                        {/* Name Input Modal */}
                        {showNameInput && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                                <div className="bg-white rounded-3xl p-6 max-w-sm w-full">
                                    <h2 className="text-xl font-bold text-center mb-4 text-gray-800">üìù Who's in the photo?</h2>
                                    <input
                                        type="text"
                                        value={nameInput}
                                        onChange={(e) => setNameInput(e.target.value)}
                                        placeholder="Enter their name (optional)"
                                        className="w-full p-3 border-2 border-gray-300 rounded-xl text-center focus:border-purple-500 focus:outline-none mb-4"
                                        autoFocus={true}
                                        onKeyDown={(e) => e.key === 'Enter' ? saveName() : e.key === 'Escape' ? skipName() : null}
                                    />
                                    <div className="flex gap-3">
                                        <button
                                            onClick={skipName}
                                            className="flex-1 bg-gray-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-gray-600 transition-colors"
                                        >
                                            Skip
                                        </button>
                                        <button
                                            onClick={saveName}
                                            className="flex-1 bg-purple-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-purple-600 transition-colors"
                                        >
                                            Save
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Photo Preview */}
                        {(previewIndex !== null) && (
                            <div className="fixed inset-0 bg-black z-50 flex flex-col" onClick={() => setPreviewIndex(null)}>
                                <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-4 text-white">
                                    <h2 className="text-lg font-semibold text-center">{categories[previewIndex]}</h2>
                                    {names[previewIndex] && <p className="text-center text-indigo-100 mt-1 font-medium">with {names[previewIndex]}</p>}
                                </div>
                                <div className="flex-1 flex items-center justify-center p-4">
                                    <img
                                        src={photos[previewIndex]}
                                        alt={categories[previewIndex]}
                                        className="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
                                        onClick={(e) => e.stopPropagation()}
                                    />
                                </div>
                            </div>
                        )}

                        {/* Camera View */}
                        {(cameraIndex !== null) && (
                            <div className="fixed inset-0 bg-black z-50 flex flex-col">
                                <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-4 text-white">
                                    <h2 className="text-lg font-semibold text-center">{categories[cameraIndex]}</h2>
                                    <p className="text-center text-sm text-indigo-100 mt-1">Take a selfie with someone who matches this!</p>
                                </div>
                                
                                <div className="flex-1 flex items-center justify-center p-4">
                                    {useFileInput ? (
                                        <div className="text-center">
                                            <div className="bg-white rounded-2xl p-8 max-w-sm">
                                                <div className="text-6xl mb-4">üì∑</div>
                                                <p className="text-gray-700 mb-4">Choose a photo from your device</p>
                                                <input
                                                    ref={fileInputRef}
                                                    type="file"
                                                    accept="image/*"
                                                    onChange={handleFileInput}
                                                    style={{ display: 'none' }}
                                                />
                                                <div className="flex gap-3">
                                                    <button
                                                        onClick={() => fileInputRef.current?.click()}
                                                        className="flex-1 bg-purple-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-purple-600 transition-colors"
                                                    >
                                                        Choose Photo
                                                    </button>
                                                    <button
                                                        onClick={stopCamera}
                                                        className="flex-1 bg-gray-500 text-white py-3 px-4 rounded-full font-semibold hover:bg-gray-600 transition-colors"
                                                    >
                                                        Cancel
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                            <video
                                                ref={videoRef}
                                                autoPlay
                                                playsInline
                                                className="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
                                            />
                                            <div className="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex gap-4">
                                                <button
                                                    onClick={capturePhoto}
                                                    className="bg-white p-4 rounded-full shadow-lg hover:bg-gray-100 transition-colors text-4xl"
                                                >
                                                    üì∑
                                                </button>
                                                <button
                                                    onClick={stopCamera}
                                                    className="bg-red-500 text-white px-6 py-3 rounded-full font-semibold hover:bg-red-600 transition-colors"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Bingo Grid */}
                        {(!cameraIndex && !previewIndex && !showNameInput) && (
                            <div className="p-6 pb-8">
                                <div className="grid grid-cols-3 gap-3">
                                    {categories.map((category, index) => (
                                        <div
                                            key={index}
                                            className={`relative aspect-square border-2 rounded-xl p-3 flex flex-col items-center justify-center text-center transition-all
                                                ${completedBoxes.has(index) ? 'border-green-500 bg-green-50 cursor-pointer hover:border-green-600' : 'border-gray-300 bg-gray-50 hover:border-purple-400 hover:bg-purple-50'}`}
                                            onClick={() => completedBoxes.has(index) && setPreviewIndex(index)}
                                        >
                                            {/* Photo background */}
                                            {(completedBoxes.has(index) && photos[index]) && (
                                                <img
                                                    src={photos[index]}
                                                    alt={category}
                                                    className="absolute inset-0 w-full h-full object-cover rounded-xl"
                                                />
                                            )}
                                            
                                            {/* Check mark */}
                                            {completedBoxes.has(index) && (
                                                <div className="absolute top-2 right-2 bg-green-500 rounded-full p-1 text-white text-xs">
                                                    ‚úì
                                                </div>
                                            )}

                                            {/* Name label */}
                                            {(completedBoxes.has(index) && names[index]) && (
                                                <div className="absolute bottom-1 left-1 right-1 bg-black/70 text-white text-xs px-2 py-1 rounded text-center truncate">
                                                    {names[index]}
                                                </div>
                                            )}

                                            {/* Category text */}
                                            <span className={`text-xs font-medium z-10 ${completedBoxes.has(index) ? 'text-white bg-black/50 px-2 py-1 rounded' : 'text-gray-700'}`}>
                                                {category}
                                            </span>

                                            {/* Camera button */}
                                            {!completedBoxes.has(index) && (
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        startCamera(index);
                                                    }}
                                                    className="mt-2 p-2 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition-colors z-10"
                                                >
                                                    üì∑
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Hidden elements */}
                        <canvas ref={canvasRef} style={{ display: 'none' }} />
                        <input
                            ref={fileInputRef}
                            type="file"
                            accept="image/*"
                            onChange={handleFileInput}
                            style={{ display: 'none' }}
                        />
                    </div>
                </div>
            );
        }

        ReactDOM.render(<HumanBingoGame />, document.getElementById('root'));
    </script>
</body>
</html>
